## CAP理论

分布式系统不可能同时满足CAP，最多只能同时满足其中两项。
* 一致性（C：Consistency）
    * 一致性指的是多个数据副本是否能保持一致的特性，在一致性的条件下，系统在执行数据更新操作之后能够从一致性状态转移到另一个一致性状态。
    * 对系统的一个数据更新成功之后，如果所有用户都能够读取到最新的值，该系统就被认为具有强一致性。
* 可用性（A：Availability）
    * 可用性指分布式系统在面对各种异常时可以提供正常服务的能力，可以用系统可用时间占总时间的比值来衡量，4 个 9 的可用性表示系统 99.99% 的时间是可用的。
    * 在可用性条件下，要求系统提供的服务一直处于可用的状态，对于用户的每一个操作请求总是能够在有限的时间内返回结果。
* 分区容忍性（P：Partition Tolerance）
    * 网络分区指分布式系统中的节点被划分为多个区域，每个区域内部可以通信，但是区域之间无法通信。
    * 在分区容忍性条件下，分布式系统在遇到任何网络分区故障的时候，仍然需要能对外提供一致性和可用性的服务，除非是整个网络环境都发生了故障。

常用两种策略：
* 保证一致性（CP），不能访问未同步完成的节点，也就失去了部分可用性；
* 保证可用性（AP），允许读取所有节点的数据，但是数据可能不一致。

微服务主要追求可用性和分区容忍性，轻一致性。

## BASE理论
强一致性： 
* 当用户完成更新数据后，任何后续线程或者其他节点都能访问到最新值。这种实现需要对性能做出较大牺牲。

弱一致性：
* 当用户完成更新数据后，并不能保证后续线程或者其他节点都能访问到最新值。它只能通过某种方式来保证最后的一致性。

基本可用（BA）：
* 指分布式系统在出现故障的时候，保证核心可用，允许损失部分可用性。
* 例如，电商在做促销时，为了保证购物系统的稳定性，部分消费者可能会被引导到一个降级的页面。

软状态（S）
* 指允许系统中的数据存在中间状态，并认为该中间状态不会影响系统整体可用性，即允许系统不同节点的数据副本之间进行同步的过程存在时延。

最终一致性(E)
* 最终一致性强调的是系统中所有的数据副本，在经过一段时间的同步后，最终能达到一致的状态。
* ACID 要求强一致性，通常运用在传统的数据库系统上。而 BASE 要求最终一致性，通过牺牲强一致性来达到可用性，通常运用在大型分布式系统中。
* 在实际的分布式场景中，不同业务单元和组件对一致性的要求是不同的，因此 ACID 和 BASE 往往会结合在一起使用。

# 一致性算法（Paxos，Raft，ZAB）
最基本的一致性算法： 主从同步
1. Master接收写请求
2. Master复制日志到slave
3. Master等待，知道所有从库返回

问题： 一个节点失败，,Master阻塞，导致整个集群不可用。保持了一致性，可用性大大降低

## Paxos
* 提议者（Proposer）：提议一个值；
* 接受者（Acceptor）：对每个提议进行投票；
* 告知者（Learner）：被告知投票的结果，不参与投票过程。

提议阶段：
1. Prepare
    * proposer提出一个议案，编号为N，此时N大于这个proposer之前提出的提案编号。请求acceptors的quorum接收
2. Promise
    * 如果N大于此acceptor之前接收的任何提案编号则接收，否则拒绝。
3. Accept
    * 如果达到了多数派，proposer会发出accept请求，此请求包含提案编号N，以及提案内容。
4. Accepted
    * 如果此acceptor在此期间没有收到任何标号大于N的天，则接收这个提案内容，否则忽略。





