## Redis 集群方案应该怎么做？都有哪些方案？
1. 主从加哨兵模式
2. codis，目前用的最多的集群方案，基本和 twemproxy 一致的效果，但它支持在节点数量改变情况下，旧节点数据可恢复到新 hash 节点。
3. Redis cluster3.0 自带的集群，特点在于他的分布式算法不是一致性 hash，而是 hash槽的概念，以及自身支持节点设置从节点。具体看官方文档介绍。

## 哈希槽的概念
Redis集群使用一种称作一致性哈希的复合分区形式（组合了哈希分区和列表分袂的特征来计算键的归属实例），键的CRC16哈希值被称为哈希槽。比如对于三个Redis节点，哈希槽的分配方式如下：
* 第一个节点拥有0-5500哈希槽
* 第二节点拥有5501-11000哈希槽
* 第三节点拥有剩余的11001-16384哈希槽

一个键的对应的哈希槽通过计算键的CRC16 哈希值，然后对16384进行取模得到。

## cluster模式的特点

1. 多主多从，去中心化：从节点作为备用，复制主节点，不做读写操作，不提供服务
2. 不支持处理多个key：因为数据分散在多个节点，在数据量大高并发的情况下会影响性能；
3. 支持动态扩容节点：这是我认为算是Rerdis Cluster最大的优点之一；
4. 节点之间相互通信，相互选举，不再依赖sentinel：准确来说是主节点之间相互“监督”，保证及时故障转移

Redis Cluster与其它集群模式的区别（随便看看）：

* 相比较sentinel模式，多个master节点保证主要业务（比如master节点主要负责写）稳定性，不需要搭建多个sentinel实例监控一个master节点；
* 相比较一主多从的模式，不需要手动切换，具有自我故障检测，故障转移的特点；
* 相比较其他两个模式而言，对数据进行分片（sharding），不同节点存储的数据是不一样的；
* 从某种程度上来说，Sentinel模式主要针对高可用（HA），而Cluster模式是不仅针对大数据量，高并发，同时也支持HA。

## cluster故障转移流程
1. 在该下线主节点的所有从节点中，选择一个做主节点
2. 被选中的从节点会执行SLAVEOF no one命令，成为新的主节点；
3. 新的主节点会撤销对所有对已下线主节点的槽指派，并将这些槽全部派给自己。
4. 新的主节点向集群广播一条PONG消息，让其他节点知道“我已经变成主节点了，并且我会接管已下线节点负责的处理的槽”；
5. 新主节点开始接收和自己负责处理的槽有关的命令请求，故障转移完成。













